# 技术说明

## TRANSFER_EVENT_TOPIC 的作用

### 什么是 TRANSFER_EVENT_TOPIC？

`TRANSFER_EVENT_TOPIC` 是 ERC20 Token 标准定义的 `Transfer` 事件的签名哈希值。

### 为什么需要它？

1. **ERC20 标准事件**：
   - ERC20 Token 标准定义了 `Transfer(address indexed from, address indexed to, uint256 value)` 事件
   - 每当 Token 发生转账时，智能合约会发出这个事件
   - 这个事件会被记录在区块链的事件日志中

2. **事件签名**：
   - `TRANSFER_EVENT_TOPIC = '0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef'`
   - 这是 `Transfer(address,address,uint256)` 的 keccak256 哈希值的前 32 字节
   - 用于在区块链上唯一标识 Transfer 事件

3. **查询 Token 转账记录**：
   - 通过查询包含这个 topic 的事件日志，可以找到所有 Token 转账记录
   - 这就是 BscScan 的 "Token Transfers" 功能的实现原理
   - **这是必需的**，没有它就无法查询 Token 转账记录

### 工作原理

```
Token 转账流程：
1. 用户调用 Token 合约的 transfer() 函数
2. 合约执行转账逻辑
3. 合约发出 Transfer 事件（包含 from, to, value）
4. 事件被记录到区块链事件日志中
5. 我们通过查询包含 TRANSFER_EVENT_TOPIC 的日志来获取转账记录
```

## 区块数量与时间的关系

### BSC 出块时间

- **BSC 出块时间**：约 **3 秒**一个区块
- 这是 BSC 链的特性，比以太坊主网（约 12 秒）快很多

### 区块数量换算

| 区块数量 | 时间（秒） | 时间（小时） | 时间（天） |
|---------|-----------|-------------|-----------|
| 1,200   | 3,600     | 1 小时      | -         |
| 5,000   | 15,000    | 4.17 小时   | 约 0.17 天 |
| 10,000  | 30,000    | 8.33 小时   | 约 0.35 天 |
| 28,800  | 86,400    | 24 小时     | 1 天       |
| 86,400  | 259,200   | 72 小时     | 3 天       |
| 288,000 | 864,000   | 240 小时    | 10 天      |
| 864,000 | 2,592,000 | 720 小时    | 30 天（1个月）|

### 代码中的设置

- **默认查询范围**：5000 个区块 ≈ **4-5 小时**
- **BNB 转账查询**：10000 个区块 ≈ **8-9 小时**

### 为什么设置这么小的范围？

1. **公共 RPC 节点限制**：
   - 查询范围越大，RPC 节点限制越严格
   - 5000 个区块是公共节点通常能支持的最大范围

2. **查询速度**：
   - 范围越小，查询越快
   - 避免超时和失败

3. **如果需要查询更长时间的数据**：
   - 使用付费 RPC 节点（Infura、Alchemy 等）
   - 或选择"查询全部历史数据"（会自动分批查询）

## 总结

1. **TRANSFER_EVENT_TOPIC 是必需的**：
   - 没有它就无法查询 Token 转账记录
   - 这是实现类似 BscScan Token Transfers 功能的核心

2. **5000 个区块不是一个月**：
   - 5000 个区块 ≈ 4-5 小时
   - 1 个月 ≈ 864,000 个区块

3. **如果需要查询更长时间的数据**：
   - 建议使用付费 RPC 节点
   - 或选择查询全部历史数据（会自动分批查询）

