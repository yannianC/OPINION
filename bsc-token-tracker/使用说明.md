# BSC Token Transfers 查询工具 - Python 脚本版

## 简介

这是一个纯 Python 脚本，可以直接在命令行中查询 BSC 链上的 Token 转账记录，无需浏览器，无需前端。

## 安装依赖

```bash
pip install web3
```

或者使用 requirements.txt：

```bash
pip install -r requirements.txt
```

## 使用方法

### 方法一：交互式运行

```bash
python bsc_query.py
```

然后按提示输入：
1. BSC 地址
2. 是否使用自定义 RPC 节点（可选）

### 方法二：命令行参数

```bash
# 基本用法
python bsc_query.py <地址>

# 指定 RPC 节点
python bsc_query.py <地址> <RPC节点地址>
```

**示例：**

```bash
# 查询地址
python bsc_query.py 0x1234567890123456789012345678901234567890

# 使用自定义 RPC 节点
python bsc_query.py 0x1234567890123456789012345678901234567890 https://bsc-dataseed2.binance.org/
```

## 功能特性

- ✅ **Token 转账查询**：查询 ERC20 Token 转账记录
- ✅ **BNB 转账查询**：查询 BNB 转账记录
- ✅ **实时数据**：直接从链上获取最新数据
- ✅ **详细信息**：显示时间、类型、方向、数量、交易哈希等
- ✅ **保存功能**：可保存查询结果到 JSON 文件
- ✅ **统计信息**：显示 Token 和 BNB 转账数量统计

## 输出示例

```
====================================================================================================
🔍 BSC Token Transfers 查询工具 (Python 版本)
====================================================================================================

请输入 BSC 地址: 0x1234567890123456789012345678901234567890
是否使用自定义 RPC 节点? (y/N): n
✅ 已连接到 BSC 节点
   最新区块: 35000000

📡 正在查询 Token 转账记录...
   地址: 0x1234567890123456789012345678901234567890
   区块范围: 0 - 35000000
   正在获取事件日志...
   找到 150 条事件日志，正在处理...
   已处理 50/150 条...
   已处理 100/150 条...
   已处理 150/150 条...
✅ Token 转账查询完成，找到 150 条记录

📡 正在查询 BNB 转账记录...
   地址: 0x1234567890123456789012345678901234567890
   区块范围: 34990000 - 35000000 (最近 10000 个区块)
   正在遍历区块...
   已检查 500 个区块，找到 5 条交易...
✅ BNB 转账查询完成，找到 5 条记录

====================================================================================================
📊 找到 155 条交易记录
====================================================================================================

📈 统计信息:
   Token 转账: 150 条
   BNB 转账: 5 条

时间                 类型     方向    Token/BNB       数量                       交易哈希
----------------------------------------------------------------------------------------------------
2024-12-09 15:30:00  Token    转入    USDT           100.000000 USDT             0x1234...5678
2024-12-09 15:25:00  BNB      转出    BNB            0.500000 BNB                0xabcd...efgh
...

是否保存到 JSON 文件? (y/N):
```

## 配置说明

### RPC 节点

默认使用 Binance 公共 RPC 节点：`https://bsc-dataseed1.binance.org/`

**可用的公共 RPC 节点：**
- `https://bsc-dataseed1.binance.org/` (默认)
- `https://bsc-dataseed2.binance.org/`
- `https://bsc-dataseed3.binance.org/`
- `https://bsc-dataseed4.binance.org/`
- `https://bsc-dataseed1.defibit.io/`
- `https://bsc-dataseed1.ninicoin.io/`

**付费 RPC 服务（性能更好）：**
- Infura: `https://bsc-mainnet.infura.io/v3/YOUR_API_KEY`
- Alchemy: `https://bsc-mainnet.g.alchemy.com/v2/YOUR_API_KEY`
- QuickNode: 你的 QuickNode 端点

## 使用限制

1. **BNB 转账查询**：默认只查询最近 10000 个区块（约 3-4 天），最多返回 100 条记录
2. **Token 转账查询**：
   - **默认模式**：只查询最近 10000 个区块（约 3-4 天）
   - **全部历史模式**：会尝试查询全部历史数据，但公共 RPC 节点限制较严，可能无法查询全部
3. **RPC 节点限制**：公共 RPC 节点对查询范围有严格限制，如果频繁出现 "limit exceeded" 错误：
   - 建议使用付费 RPC 节点（Infura、Alchemy 等）
   - 或只查询最近的数据
   - 或等待一段时间后重试
4. **显示数量**：默认只显示前 50 条记录，完整数据会保存到 JSON 文件

## 注意事项

1. **网络连接**：确保能够访问 BSC RPC 节点
2. **查询速度**：Token 转账查询较快，BNB 转账需要遍历区块，可能较慢
3. **数据量**：如果地址交易记录很多，查询可能需要一些时间

## 常见问题

### Q: 提示 "Web3 初始化失败"
A: 检查网络连接，确保能够访问 RPC 节点。可以尝试更换其他 RPC 节点。

### Q: 查询很慢
A: BNB 转账需要遍历区块，查询大量历史数据会较慢。Token 转账查询通常较快。

### Q: 如何查询更早的历史数据？
A: 选择查询全部历史数据，但公共 RPC 节点限制较严，可能无法查询全部。建议使用付费 RPC 节点（Infura、Alchemy 等）来查询更多历史数据。

### Q: 频繁出现 "limit exceeded" 错误怎么办？
A: 这是公共 RPC 节点的限制。解决方案：
1. 使用付费 RPC 节点（推荐）
2. 只查询最近的数据（默认模式）
3. 等待一段时间后重试
4. 使用多个不同的公共 RPC 节点轮换

### Q: 可以批量查询多个地址吗？
A: 可以修改脚本，添加循环来批量查询多个地址。

## 技术说明

- **Web3.py**: 用于连接 BSC 节点
- **Python 3.7+**: 需要 Python 3.7 或更高版本
- **无其他依赖**: 只需要 web3 库

