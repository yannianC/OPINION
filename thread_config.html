<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¡µé¢7-é…ç½®çº¿ç¨‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .controls {
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .refresh-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .refresh-btn:active {
            transform: translateY(0);
        }

        .refresh-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .save-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
            margin-left: 10px;
        }

        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.6);
        }

        .save-btn:active {
            transform: translateY(0);
        }

        .save-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .add-rows-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4);
            margin-left: 10px;
        }

        .add-rows-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 87, 108, 0.6);
        }

        .add-rows-btn:active {
            transform: translateY(0);
        }

        .clean-mission-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
            margin-left: 10px;
        }

        .clean-mission-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
        }

        .clean-mission-btn:active {
            transform: translateY(0);
        }

        .clean-mission-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .row-save-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 6px 20px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
            min-width: 80px;
        }

        .row-save-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.5);
        }

        .row-save-btn:active {
            transform: translateY(0);
        }

        .row-save-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .blacklist-btn {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            border: none;
            padding: 6px 16px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);
            margin-left: 8px;
        }

        .blacklist-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.5);
        }

        .blacklist-btn:active {
            transform: translateY(0);
        }

        .blacklist-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .unblacklist-btn {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
            color: white;
            border: none;
            padding: 6px 16px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(255, 193, 7, 0.3);
            margin-left: 8px;
        }

        .unblacklist-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.5);
        }

        .unblacklist-btn:active {
            transform: translateY(0);
        }

        .unblacklist-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .group-input {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            width: 120px;
            transition: border-color 0.3s ease;
        }

        .group-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .new-row {
            background-color: #fff3cd;
        }

        .action-cell {
            text-align: center;
            width: 200px;
        }

        .action-cell .button-group {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .table-container {
            padding: 15px 20px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f8f9fa;
        }

        th {
            padding: 10px 12px;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
            font-size: 14px;
        }

        td {
            padding: 10px 12px;
            border-bottom: 1px solid #e9ecef;
            font-size: 14px;
            color: #212529;
        }

        tbody tr {
            transition: background-color 0.2s ease;
        }

        tbody tr:hover {
            background-color: #f8f9fa;
        }

        .thread-input {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            width: 120px;
            transition: border-color 0.3s ease;
        }

        .thread-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            text-align: center;
            padding: 60px 20px;
            color: #dc3545;
            background: #f8d7da;
            margin: 20px;
            border-radius: 6px;
        }

        .empty {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            max-width: 500px;
            animation: slideIn 0.3s ease-out;
            font-size: 14px;
        }

        .toast.success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .toast.error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .toast-icon {
            font-size: 20px;
            flex-shrink: 0;
        }

        .toast-message {
            flex: 1;
            font-weight: 500;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        .toast.hide {
            animation: slideOut 0.3s ease-out forwards;
        }

        .computer-group {
            font-weight: 600;
            color: #495057;
        }

        .index-cell {
            text-align: center;
            width: 60px;
            color: #6c757d;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
 
        <h1>
            é¡µé¢7-é…ç½®çº¿ç¨‹
        </h1>
        <div class="controls">
            <div class="button-group">
                <button class="refresh-btn" id="refreshBtn" onclick="loadData()">
                    ğŸ”„ åˆ·æ–°æ•°æ®
                </button>
                <button class="save-btn" id="saveBtn" onclick="saveConfig()">
                    ğŸ’¾ ä¿å­˜é…ç½®
                </button>
                <button class="add-rows-btn" id="addRowsBtn" onclick="addTenRows()">
                    â• æ–°å¢åè¡Œ
                </button>
                <button class="clean-mission-btn" id="cleanMissionBtn" onclick="cleanAllMission()">
                    ğŸ—‘ï¸ æ¸…ç©ºä»»åŠ¡
                </button>
            </div>
        </div>

        <div class="table-container" id="tableContainer">
            <div class="loading">æ­£åœ¨åŠ è½½æ•°æ®...</div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡ï¼šä¿å­˜é…ç½®æ•°æ®
        let configData = [];
        let rowIndexCounter = 0; // ç”¨äºç”Ÿæˆå”¯ä¸€çš„è¡Œç´¢å¼•
        let blackList = []; // æ‹‰é»‘åå•

        // åŠ è½½æ‹‰é»‘åå•
        async function loadBlackList() {
            try {
                const response = await fetch('https://sg.bicoin.com.cn/99l/hedge/tempGroupBlackList');
                const result = await response.json();

                if (result.code === 0 && result.data && result.data.list) {
                    blackList = result.data.list.map(item => item.group || item);
                } else {
                    blackList = [];
                }
            } catch (error) {
                console.error('åŠ è½½æ‹‰é»‘åå•å¤±è´¥:', error);
                blackList = [];
            }
        }

        // æ›´æ–°å•è¡Œçš„æ‹‰é»‘æŒ‰é’®çŠ¶æ€
        async function updateRowBlacklistButton(rowId, computerGroup) {
            try {
                // é‡æ–°åŠ è½½æ‹‰é»‘åå•
                await loadBlackList();
                
                // æ›´æ–°å½“å‰è¡Œçš„æ‹‰é»‘æŒ‰é’®
                const actionCell = document.querySelector(`#${rowId} .action-cell .button-group`);
                if (actionCell) {
                    const isBlack = isBlacklisted(computerGroup);
                    
                    // ç§»é™¤æ—§çš„æ‹‰é»‘æŒ‰é’®
                    const oldBlacklistBtn = actionCell.querySelector('.blacklist-btn, .unblacklist-btn');
                    if (oldBlacklistBtn) {
                        oldBlacklistBtn.remove();
                    }
                    
                    // åˆ›å»ºæ–°çš„æ‹‰é»‘æŒ‰é’®
                    const newBlacklistBtn = document.createElement('button');
                    if (isBlack) {
                        newBlacklistBtn.className = 'unblacklist-btn';
                        newBlacklistBtn.textContent = 'è§£é™¤æ‹‰é»‘';
                        newBlacklistBtn.onclick = () => unblacklistGroup(rowId);
                    } else {
                        newBlacklistBtn.className = 'blacklist-btn';
                        newBlacklistBtn.textContent = 'æ‹‰é»‘';
                        newBlacklistBtn.onclick = () => blacklistGroup(rowId);
                    }
                    
                    // æ·»åŠ åˆ°æŒ‰é’®ç»„
                    actionCell.appendChild(newBlacklistBtn);
                }
            } catch (error) {
                console.error('æ›´æ–°æ‹‰é»‘æŒ‰é’®å¤±è´¥:', error);
            }
        }

        // é™é»˜åˆ·æ–°æ•°æ®ï¼ˆä¸æ˜¾ç¤ºåŠ è½½çŠ¶æ€ï¼‰
        async function silentRefresh() {
            try {
                // å¹¶è¡ŒåŠ è½½é…ç½®æ•°æ®å’Œæ‹‰é»‘åå•
                await Promise.all([
                    loadBlackList(),
                    (async () => {
                        const response = await fetch('https://sg.bicoin.com.cn/99l/hedge/computerGroupSetting');
                        const result = await response.json();

                        if (result.code === 0 && result.data && result.data.list) {
                            configData = result.data.list;
                        }
                    })()
                ]);

                // é™é»˜æ›´æ–°æ˜¾ç¤º
                displayData(configData);
            } catch (error) {
                console.error('é™é»˜åˆ·æ–°å¤±è´¥:', error);
            }
        }

        // åŠ è½½é…ç½®æ•°æ®
        async function loadData() {
            const refreshBtn = document.getElementById('refreshBtn');
            const tableContainer = document.getElementById('tableContainer');
            
            // ç¦ç”¨æŒ‰é’®å¹¶æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            refreshBtn.disabled = true;
            refreshBtn.textContent = 'ğŸ”„ åŠ è½½ä¸­...';
            tableContainer.innerHTML = '<div class="loading">æ­£åœ¨åŠ è½½æ•°æ®...</div>';

            try {
                // å¹¶è¡ŒåŠ è½½é…ç½®æ•°æ®å’Œæ‹‰é»‘åå•
                await Promise.all([
                    loadBlackList(),
                    (async () => {
                        const response = await fetch('https://sg.bicoin.com.cn/99l/hedge/computerGroupSetting');
                        const result = await response.json();

                        if (result.code === 0 && result.data && result.data.list) {
                            configData = result.data.list;
                        } else {
                            throw new Error(result.msg || 'æ•°æ®æ ¼å¼é”™è¯¯');
                        }
                    })()
                ]);

                displayData(configData);
            } catch (error) {
                tableContainer.innerHTML = `
                    <div class="error">
                        <h3>âŒ åŠ è½½å¤±è´¥</h3>
                        <p>${error.message}</p>
                        <p style="margin-top: 10px; font-size: 12px;">è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•</p>
                    </div>
                `;
            } finally {
                refreshBtn.disabled = false;
                refreshBtn.textContent = 'ğŸ”„ åˆ·æ–°æ•°æ®';
            }
        }

        // æ£€æŸ¥ç”µè„‘ç»„æ˜¯å¦åœ¨æ‹‰é»‘åå•ä¸­
        function isBlacklisted(computerGroup) {
            return blackList.includes(computerGroup) || blackList.includes(parseInt(computerGroup));
        }

        // æ˜¾ç¤ºæ•°æ®
        function displayData(list) {
            const tableContainer = document.getElementById('tableContainer');
            
            // ç”Ÿæˆè¡¨æ ¼HTML
            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th class="index-cell">åºå·</th>
                            <th>ç”µè„‘ç»„</th>
                            <th>çº¿ç¨‹æ•°</th>
                            <th class="action-cell">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            // æ˜¾ç¤ºå·²æœ‰æ•°æ®
            if (list && list.length > 0) {
                list.forEach((item, index) => {
                    const rowId = `row_${rowIndexCounter++}`;
                    const computerGroup = item.computerGroup || '';
                    const isBlack = isBlacklisted(computerGroup);
                    const blacklistButton = isBlack 
                        ? `<button class="unblacklist-btn" onclick="unblacklistGroup('${rowId}')">è§£é™¤æ‹‰é»‘</button>`
                        : `<button class="blacklist-btn" onclick="blacklistGroup('${rowId}')">æ‹‰é»‘</button>`;
                    
                    tableHTML += `
                        <tr id="${rowId}">
                            <td class="index-cell">${index + 1}</td>
                            <td>
                                <input type="number" 
                                       class="group-input" 
                                       id="group_${rowId}"
                                       value="${computerGroup}" 
                                       min="1" 
                                       step="1"
                                       placeholder="è¾“å…¥ç”µè„‘ç»„">
                            </td>
                            <td>
                                <input type="number" 
                                       class="thread-input" 
                                       id="thread_${rowId}"
                                       value="${item.threadCount || 0}" 
                                       min="1" 
                                       step="1"
                                       placeholder="è¾“å…¥çº¿ç¨‹æ•°">
                            </td>
                            <td class="action-cell">
                                <div class="button-group">
                                    <button class="row-save-btn" onclick="saveRow('${rowId}')">
                                        ğŸ’¾ ä¿å­˜
                                    </button>
                                    ${blacklistButton}
                                </div>
                            </td>
                        </tr>
                    `;
                });
            }

            tableHTML += `
                    </tbody>
                </table>
            `;

            tableContainer.innerHTML = tableHTML;
        }

        // æ–°å¢åè¡Œ
        function addTenRows() {
            const tableContainer = document.getElementById('tableContainer');
            let tbody = tableContainer.querySelector('tbody');
            
            // å¦‚æœè¡¨æ ¼ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°è¡¨æ ¼
            if (!tbody) {
                const tableHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th class="index-cell">åºå·</th>
                                <th>ç”µè„‘ç»„</th>
                                <th>çº¿ç¨‹æ•°</th>
                                <th class="action-cell">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                `;
                tableContainer.innerHTML = tableHTML;
                tbody = tableContainer.querySelector('tbody');
            }

            // è·å–å½“å‰å·²æœ‰è¡Œæ•°ï¼Œç”¨äºè®¡ç®—åºå·
            const existingRows = tbody.querySelectorAll('tr');
            const startIndex = existingRows.length;

            // æ·»åŠ 10è¡Œç©ºæ•°æ®
            for (let i = 0; i < 10; i++) {
                const rowId = `row_${rowIndexCounter++}`;
                const row = document.createElement('tr');
                row.id = rowId;
                row.className = 'new-row';
                row.innerHTML = `
                    <td class="index-cell">${startIndex + i + 1}</td>
                    <td>
                        <input type="number" 
                               class="group-input" 
                               id="group_${rowId}"
                               value="" 
                               min="1" 
                               step="1"
                               placeholder="è¾“å…¥ç”µè„‘ç»„">
                    </td>
                    <td>
                        <input type="number" 
                               class="thread-input" 
                               id="thread_${rowId}"
                               value="" 
                               min="1" 
                               step="1"
                               placeholder="è¾“å…¥çº¿ç¨‹æ•°">
                    </td>
                    <td class="action-cell">
                        <div class="button-group">
                            <button class="row-save-btn" onclick="saveRow('${rowId}')">
                                ğŸ’¾ ä¿å­˜
                            </button>
                            <button class="blacklist-btn" onclick="blacklistGroup('${rowId}')">æ‹‰é»‘</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            }

            // æ»šåŠ¨åˆ°æ–°å¢çš„è¡Œ
            const newRows = tbody.querySelectorAll('.new-row');
            if (newRows.length > 0) {
                newRows[newRows.length - 1].scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }

        // ä¿å­˜å•è¡Œæ•°æ®
        async function saveRow(rowId) {
            const saveBtn = document.querySelector(`#${rowId} .row-save-btn`);
            const groupInput = document.getElementById(`group_${rowId}`);
            const threadInput = document.getElementById(`thread_${rowId}`);
            
            const computerGroup = parseInt(groupInput.value);
            const threadCount = parseInt(threadInput.value);
            
            // éªŒè¯è¾“å…¥
            if (isNaN(computerGroup) || computerGroup < 1) {
                showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„ç”µè„‘ç»„å·ï¼ˆå¤§äºç­‰äº1çš„æ•´æ•°ï¼‰', 'error');
                return;
            }
            
            if (isNaN(threadCount) || threadCount < 1) {
                showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„çº¿ç¨‹æ•°ï¼ˆå¤§äºç­‰äº1çš„æ•´æ•°ï¼‰', 'error');
                return;
            }

            // ç¦ç”¨æŒ‰é’®å¹¶æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            saveBtn.disabled = true;
            saveBtn.textContent = 'â³ ä¿å­˜ä¸­...';

            try {
                const response = await fetch('https://sg.bicoin.com.cn/99l/hedge/computerGroupSetting', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        list: [{
                            computerGroup: computerGroup,
                            threadCount: threadCount
                        }]
                    })
                });

                const result = await response.json();

                if (result.code === 0) {
                    showToast(`ç”µè„‘ç»„ ${computerGroup} ä¿å­˜æˆåŠŸ`, 'success');
                    // ç§»é™¤æ–°å¢è¡Œçš„æ ·å¼æ ‡è®°
                    const row = document.getElementById(rowId);
                    if (row) {
                        row.classList.remove('new-row');
                    }
                    // åªæ›´æ–°å½“å‰è¡Œçš„æ‹‰é»‘æŒ‰é’®çŠ¶æ€
                    await updateRowBlacklistButton(rowId, computerGroup);
                } else {
                    throw new Error(result.msg || 'ä¿å­˜å¤±è´¥');
                }
            } catch (error) {
                showToast('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = 'ğŸ’¾ ä¿å­˜';
            }
        }

        // ä¿å­˜é…ç½®ï¼ˆæ‰¹é‡ä¿å­˜æ‰€æœ‰è¡Œï¼‰
        async function saveConfig() {
            const saveBtn = document.getElementById('saveBtn');
            const tableContainer = document.getElementById('tableContainer');
            const rows = tableContainer.querySelectorAll('tbody tr');
            
            if (rows.length === 0) {
                showToast('æ²¡æœ‰å¯ä¿å­˜çš„æ•°æ®', 'error');
                return;
            }
            
            const updateList = [];
            
            // æ”¶é›†æ‰€æœ‰è¡Œçš„æ•°æ®
            rows.forEach(row => {
                const rowId = row.id;
                const groupInput = document.getElementById(`group_${rowId}`);
                const threadInput = document.getElementById(`thread_${rowId}`);
                
                if (!groupInput || !threadInput) {
                    return;
                }
                
                const computerGroup = parseInt(groupInput.value);
                const threadCount = parseInt(threadInput.value);
                
                // è·³è¿‡ç©ºè¡Œ
                if (isNaN(computerGroup) || isNaN(threadCount) || computerGroup < 1 || threadCount < 1) {
                    return;
                }
                
                updateList.push({
                    computerGroup: computerGroup,
                    threadCount: threadCount
                });
            });

            if (updateList.length === 0) {
                showToast('æ²¡æœ‰å¯ä¿å­˜çš„æ•°æ®ï¼Œè¯·å¡«å†™ç”µè„‘ç»„å’Œçº¿ç¨‹æ•°', 'error');
                return;
            }

            // ç¦ç”¨æŒ‰é’®å¹¶æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            saveBtn.disabled = true;
            saveBtn.textContent = 'â³ ä¿å­˜ä¸­...';

            try {
                const response = await fetch('https://sg.bicoin.com.cn/99l/hedge/computerGroupSetting', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        list: updateList
                    })
                });

                const result = await response.json();

                if (result.code === 0) {
                    showToast(`æˆåŠŸä¿å­˜ ${updateList.length} æ¡é…ç½®`, 'success');
                    // æ›´æ–°æœ¬åœ°æ•°æ®
                    configData = updateList;
                    // åˆ·æ–°æ•°æ®ä»¥è·å–æœ€æ–°çŠ¶æ€
                    await loadData();
                } else {
                    throw new Error(result.msg || 'ä¿å­˜å¤±è´¥');
                }
            } catch (error) {
                showToast('ä¿å­˜é…ç½®å¤±è´¥: ' + error.message, 'error');
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = 'ğŸ’¾ ä¿å­˜é…ç½®';
            }
        }

        // æ‹‰é»‘ç”µè„‘ç»„
        async function blacklistGroup(rowId) {
            const groupInput = document.getElementById(`group_${rowId}`);
            const computerGroup = parseInt(groupInput.value);
            
            if (isNaN(computerGroup) || computerGroup < 1) {
                showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„ç”µè„‘ç»„å·', 'error');
                return;
            }

            const blacklistBtn = document.querySelector(`#${rowId} .blacklist-btn`);
            if (blacklistBtn) {
                blacklistBtn.disabled = true;
                blacklistBtn.textContent = 'å¤„ç†ä¸­...';
            }

            try {
                const response = await fetch('https://sg.bicoin.com.cn/99l/hedge/addTempGroupBlack', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        group: computerGroup
                    })
                });

                const result = await response.json();

                if (result.code === 0) {
                    showToast(`ç”µè„‘ç»„ ${computerGroup} å·²æ‹‰é»‘`, 'success');
                    // é™é»˜åˆ·æ–°æ•°æ®
                    await silentRefresh();
                } else {
                    throw new Error(result.msg || 'æ‹‰é»‘å¤±è´¥');
                }
            } catch (error) {
                showToast('æ‹‰é»‘å¤±è´¥: ' + error.message, 'error');
                if (blacklistBtn) {
                    blacklistBtn.disabled = false;
                    blacklistBtn.textContent = 'æ‹‰é»‘';
                }
            }
        }

        // è§£é™¤æ‹‰é»‘ç”µè„‘ç»„
        async function unblacklistGroup(rowId) {
            const groupInput = document.getElementById(`group_${rowId}`);
            const computerGroup = parseInt(groupInput.value);
            
            if (isNaN(computerGroup) || computerGroup < 1) {
                showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„ç”µè„‘ç»„å·', 'error');
                return;
            }

            const unblacklistBtn = document.querySelector(`#${rowId} .unblacklist-btn`);
            if (unblacklistBtn) {
                unblacklistBtn.disabled = true;
                unblacklistBtn.textContent = 'å¤„ç†ä¸­...';
            }

            try {
                const response = await fetch('https://sg.bicoin.com.cn/99l/hedge/removeTempGroupBlack', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        group: computerGroup
                    })
                });

                const result = await response.json();

                if (result.code === 0) {
                    showToast(`ç”µè„‘ç»„ ${computerGroup} å·²è§£é™¤æ‹‰é»‘`, 'success');
                    // é™é»˜åˆ·æ–°æ•°æ®
                    await silentRefresh();
                } else {
                    throw new Error(result.msg || 'è§£é™¤æ‹‰é»‘å¤±è´¥');
                }
            } catch (error) {
                showToast('è§£é™¤æ‹‰é»‘å¤±è´¥: ' + error.message, 'error');
                if (unblacklistBtn) {
                    unblacklistBtn.disabled = false;
                    unblacklistBtn.textContent = 'è§£é™¤æ‹‰é»‘';
                }
            }
        }

        // æ¸…ç©ºä»»åŠ¡åˆ—è¡¨
        async function cleanAllMission() {
            const cleanBtn = document.getElementById('cleanMissionBtn');
            
            // ç¡®è®¤æ“ä½œ
            if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ä»»åŠ¡å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                return;
            }

            // ç¦ç”¨æŒ‰é’®å¹¶æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            cleanBtn.disabled = true;
            cleanBtn.textContent = 'â³ æ¸…ç©ºä¸­...';

            try {
                const response = await fetch('https://sg.bicoin.com.cn/99l/mission/cleanAllMission', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                const result = await response.json();

                if (result.code === 0) {
                    showToast('ä»»åŠ¡åˆ—è¡¨å·²æ¸…ç©º', 'success');
                } else {
                    throw new Error(result.msg || 'æ¸…ç©ºä»»åŠ¡å¤±è´¥');
                }
            } catch (error) {
                showToast('æ¸…ç©ºä»»åŠ¡å¤±è´¥: ' + error.message, 'error');
            } finally {
                cleanBtn.disabled = false;
                cleanBtn.textContent = 'ğŸ—‘ï¸ æ¸…ç©ºä»»åŠ¡';
            }
        }

        // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showToast(message, type = 'success') {
            // ç§»é™¤å·²å­˜åœ¨çš„ toast
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }

            // åˆ›å»ºæ–°çš„ toast
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icon = type === 'success' ? 'âœ…' : 'âŒ';
            toast.innerHTML = `
                <span class="toast-icon">${icon}</span>
                <span class="toast-message">${message}</span>
            `;

            document.body.appendChild(toast);

            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                toast.classList.add('hide');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–æ•°æ®
        window.addEventListener('DOMContentLoaded', () => {
            loadData();
        });
    </script>
</body>
</html>
